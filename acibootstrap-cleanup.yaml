---
#- name: ACIBOOTSTRAP Get APIC Creds
#  hosts: localhost
#  gather_facts: no
#  vars_prompt:
#    - name: apic_ip
#      prompt: "Enter APIC IP"
#      private: no
#      required: yes
#
#    - name: user
#      prompt: "Enter APIC Username"
#      private: no
#      default: "admin"
#      prompt: "Enter APIC Password"
#      private: no
#
#  tasks:
#    - add_host:
#        name: "{{ apic_ip }}"
#        groups: apic
#    - set_fact:
#        user: "{{ user }}"


- name: ACIBOOTSTRAP Delete Base Interface Policies
  hosts: apic
  connection: local
  gather_facts: no


  tasks:
    - name: Delete CDP_ENABLE
      aci_rest: action=post uri=/api/mo/uni.json config_file=files/configs/static/cdpIfP-CDP_ENABLE_del.json host={{ inventory_hostname }} username={{ user }} password ={{ pass }}
    - name: Delete CDP_DISABLE
      aci_rest: action=post uri=api/mo/uni.json config_file=files/configs/static/cdpIfP-CDP_DISABLE_del.json host={{ inventory_hostname }} username={{ user }} password ={{ pass }}
    - name: Delete LLDP_ENABLE
      aci_rest: action=post uri=api/mo/uni.json config_file=files/configs/static/lldpIfP-LLDP_ENABLE_del.json host={{ inventory_hostname }} username={{ user }} password ={{ pass }}
    - name: Delete LLDP_DISABLE
      aci_rest: action=post uri=api/mo/uni.json config_file=files/configs/static/lldpIfP-LLDP_DISABLE_del.json host={{ inventory_hostname }} username={{ user }} password ={{ pass }}
    - name: Delete Port Channel LACP_ACTIVE
      aci_rest: action=post uri=api/mo/uni.json config_file=files/configs/static/lacplagp-LACP_ACTIVE_del.json host={{ inventory_hostname }} username={{ user }} password ={{ pass }}
    - name: Delete Port Channel MAC_PINNING
      aci_rest: action=post uri=api/mo/uni.json config_file=files/configs/static/lacplagp-MAC_PINNING_del.json host={{ inventory_hostname }} username={{ user }} password ={{ pass }}

- name: ACIBOOTSTRAP Setup Tenant {{ vars.tenant_name }}
  hosts: apic
  connection: local
  gather_facts: no
  vars:
    tenant_name: "POC"
    status: "deleted"

  #vars_prompt:
  #  - name: tenant_name
  #    prompt: "Enter Tenant Name:"
  #    private: no
  #    default: "POC"

  tasks:
    - name: Create base Tenant Config from Template
      template: src=files/configs/templates/tn-poc.j2 dest=files/configs/custom/tn-{{ vars.tenant_name }}.json
    - name: Delete base {{ vars.tenant_name }} Tenant
      aci_rest: action=post uri=api/mo/uni.json config_file=files/configs/custom/tn-{{ vars.tenant_name }}.json host={{ inventory_hostname }} username={{ user }} password ={{ pass }}

- name: ACIBOOTSTRAP Local Cleanup
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Delete Custom Configs
      file:
        state: absent
        path: "files/configs/custom/"
    - name: Create Empty Custom Configs folder
      file:
        state: directory
        path: "files/configs/custom"
